\documentclass[12pt,modern]{aastex61}
\usepackage{graphics,graphicx}
\usepackage{hyperref}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{comment}
\usepackage{grffile} % checks for multiple dots in figure filenames

%% Reintroduced the \received and \accepted commands from AASTeX v5.2
%\received{July 1, 2016}
%\revised{September 27, 2016}
%\accepted{\today}
%% Command to document which AAS Journal the manuscript was submitted to.
%% Adds "Submitted to " the arguement.
\submitjournal{AAS journals.}


\shortauthors{Bouma et al.}
\shorttitle{Binarity and Occurrence Rates}


\newcommand{\pp}{\mathcal{P}}
\newcommand{\ps}{\mathcal{S}}
\renewcommand{\a}{_{\rm a}}
\newcommand{\s}{_{\rm s}}
\begin{document}
    
\title{ The effects of binarity on planet occurrence rates measured by transit 
surveys}
%
\correspondingauthor{L. Bouma}
\email{luke@astro.princeton.edu}
%
\author{L. G. Bouma}
\affiliation{
    Department of Astrophysical Sciences,
    Princeton University,
    4 Ivy Lane, Princeton, NJ 08540, USA}
\author{J. N. Winn}
\affiliation{
    Department of Astrophysical Sciences,
    Princeton University,
    4 Ivy Lane, Princeton, NJ 08540, USA}
\author{K. Masuda}
\affiliation{
    Department of Astrophysical Sciences,
    Princeton University,
    4 Ivy Lane, Princeton, NJ 08540, USA}
%
%
\begin{abstract}
%
This work aims to clarify the biases that stellar binarity introduces
to occurrence rates inferred from transit surveys.
In general, stellar multiplicity leads to diluted planetary 
radii, overestimated detection efficiencies, and an undercounted number of 
selected stars (but possibly an overcounted number of searched stars).
These effects skew occurrence rate measurements in different directions, and 
we develop simple models that allow us to understand the crucial effects.
For a model in which all stellar systems are either single or twin binaries, 
and all planets are identical, we find that ignoring binarity leads to an 
underestimate of the occurrence at the true radius by a multiplicative factor 
of $0.76$ (assuming a 10\% twin binary fraction).
Using more realistic models for the stellar population and planetary 
radii, we find that ignoring binarity leads to a $10$\,-\,$30\%$ 
underestimate of the number of planets per star, depending on the true radius 
distribution.
For the occurrence of Earth-sized planets, in our most realistic model the 
rate is underestimated by $\approx 15\%$~--~at present far smaller than 
systematic uncertainties on real $\eta_\oplus$ measurements.
For hot Jupiters, we find that the inferred occurrence rate is 
$\approx 1.3\times$ smaller than the true rate around single stars.
We suggest that this latter effect contributes to the discrepant hot Jupiter 
rates measured by {\it Kepler}\ and the California group's respective surveys.
%
\end{abstract}
%
\keywords{
    methods: data analysis ---
    planets and satellites: detection ---
    surveys}
%
%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\input{introduction}

\section{Introduction}

A group of astronomers wants to measure the mean number of planets of a 
certain type per star of a certain type.
Ignoring stellar multiplicity, they perform a signal-to-noise limited transit 
survey, and detect a set of planets that appear to be of the desired class.
They then choose the stars (among those initially surveyed) around which the 
planets of interest appeared to be searchable.
Correcting for the geometric transit probability $p_{\rm tra}$, they report an 
apparent rate density,
\begin{equation}
\Gamma\a(\pp\a, \ps\a) = \frac{N_{\rm det}(\pp\a, \ps\a)}{N_{\rm s,a}(\pp\a, 
    \ps\a)} \times \frac{1}{p_{\rm tra}(\pp\a, \ps\a)}.
\label{eq:wouldnt_it_be_nice}
\end{equation}
where $\pp\a$, $\ps\a$ are the apparent planetary and stellar parameters, 
respectively.
Here $N_{\rm det}(\pp\a, \ps\a)$ is the number of 
detected planets with parameters $\pp\a,\ps\a$, per unit $\pp\a$ and $\ps\a$. 
The quantity $N_{\rm s,a}(\pp\a, \ps\a)$ is the number of unresolved 
point-sources on the sky the appear to be searchable.

There are many potential pitfalls.  Some genuine transit signals can be missed
by the detection pipeline.  Some apparent transit signals are spurious, from
noise fluctuations, failures of `detrending', or instrumental effects.  Stars
and planets can be misclassified due to statistical and systematic errors in
the measurements of their properties.  Poor angular resolution causes false
positives due to blends with background eclipsing binaries. {\it Et cetera}.

Here we focus on problems that arise from the fact that many stars exist in 
multiple star systems.
For simplicity, we consider only binaries, and we assume that they are all 
spatially unresolved.

An immediate complication is that, due to dynamical stability or some 
aspect of planet formation, the occurrence rate of planets might differ 
between binary and single-star systems.
If ``occurrence rate'' is defined as the mean number of planets within 
set radius and period bounds per star in a given mass interval, it must 
implicitly marginalize over stellar multiplicity.
This means marginalizing over ``occurrence rates in single star systems'', 
``occurrence rates about primaries'', and
``occurrence rates about secondaries''
\citep[see][]{wang_occurrence_2015}.

Outside of astrophysical differences, there are observational biases for every 
term in Eq.~\ref{eq:wouldnt_it_be_nice}.
There are errors in $N_{\rm det}$ due to planet radius 
misclassification.
There are errors in $N_{{\rm s,a}}$ because a given point on the sky
There are errors in $p_{\rm tra}(\pp\a,\ps\a)$ because stars in binaries may 
have different masses and radii than assumed in the single-star case.
Binarity might also affect the observers' ability to correctly select 
searchable stars (but see Sec.~\ref{sec:model_1} for discussion of why this is 
a second-order effect).

Finally, there are errors in $p_{\rm det}$ because detection efficiencies 
for planets orbiting single stars, primaries, and secondaries are all 
different.

Correcting for binarity's observational biases is non-trivial.
For instance, in counting the number of selected stars, even after realizing 
that binaries count as two stars, one must note that the multiplicity 
fraction of {\it selected} stars is greater than that of a volume limited 
sample.
This is the familiar Malmquist bias: binaries are selected out to larger 
distances than single stars because they are more luminous.
As a separate challenge, finding the correct number of detected planets in a 
radius bin, $N_{\rm det}$, requires knowledge of the true planetary radii.
Observers deduce apparent radii.
In binaries, the apparent and true radii differ because of diluting flux, 
and possibly because the planet is assumed to orbit the wrong star
\citep[\textit{e.g.},][]{furlan_kepler_2017}.

To gain intuition for the many observational biases at play,
we consider a set of idealized transit surveys:
\begin{itemize}
    \item Model \#1: fixed stars, fixed planets, twin binaries;
    \item Model \#2: fixed planets and primaries, varying secondaries;
    \item Model \#3: fixed primaries, varying planets and secondaries.
\end{itemize}
We define our terminology in Sec.~\ref{sec:definitions}, and present
our transit survey models in Secs.~\ref{sec:model_1}-\ref{sec:model_3}, where 
each subsection corresponds to a model listed above.
We interpret these calculations throughout, and in 
Sec.~\ref{sec:discussion} connect them to topical questions in 
the interpretation of transit survey occurrence rates.
In particular, we mention the ``hot Jupiter rate discrepancy'', the relevance 
towards measurements of $\eta_\oplus$, and the implications for detailed 
study of \citet{fulton_california-_2017}'s recently discovered ``valley''.
We conclude in Sec.~\ref{sec:conclusion}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\input{methods}

\section{Definitions}
\label{sec:definitions}
We define the occurrence rate density, $\Gamma$, as the expected number of 
planets per star per bin of planetary or stellar phase space.
Since we will mainly be concerned with the rate density's dependence on 
planetary radii $r$, we write
\begin{equation}
\Gamma(r) = \frac{{\rm d}\Lambda}{{\rm d}r},
\label{eq:rate_density_defn}
\end{equation}
where $\Lambda$ is the occurrence rate.
In this notation, ``the occurrence rate of planets of a particular size'' 
translates to an integral of Eq.~\ref{eq:rate_density_defn}, evaluated over a 
radius interval.

The above definition implicitly marginalizes the rate density over stellar 
multiplicity.
In this study we only consider single and binary star systems.
For a selected population of stars and planets, the rate density is then 
a weighted sum of rate densities for each system type:
\begin{equation}
N_{\rm tot} \Gamma(r) =
N_0 \Gamma_0(r) +
N_1 \Gamma_1(r) +
N_2 \Gamma_2(r),
\label{eq:rate_density_marginalized}
\end{equation}
where $i=0$ corresponds to single stars, $i=1$ to primaries of 
binaries, and $i=2$ to secondaries of binaries.
$N_{\rm tot} = \sum_i N_i$ is the total number of selected stars, and 
$N_0,N_1,N_2$ are the number of selected single stars, primaries, and 
secondaries.
Since each selected binary system contributes both a 
primary and secondary star, $N_1=N_2$.
This redundancy in our notation will later prove its use.

Finally, it is helpful to write 
$\Gamma_i(r)$, the rate density for each type of star, as the product of a 
shape function and a constant:
\begin{equation}
\Gamma_i(r) = \frac{{\rm d}\Lambda_i}{{\rm d}r} = Z_i p_i(r),
\quad {\rm for}\ i\in\{0,1,2\}.
\label{eq:rate_density_shape}
\end{equation}
The shape function is normalized to unity.
The $Z_i$'s can be interpreted as each system type's occurrence rate 
$\Lambda_i$, integrated over all planetary radii.
They are equivalent to the number of planets per single star, primary, or 
secondary.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\input{results}

\section{Idealized Models of Transit Surveys}

\subsection{Model \#1: fixed stars, fixed planets, twin binaries}
\label{sec:model_1}

Since the effects of binarity are most pronounced when the two components are 
similar, we begin by considering a universe in which all planets are 
identical, and all stars are identical except that some fraction of them exist 
in binaries.

Expressed mathematically, from Eqs.~\ref{eq:rate_density_marginalized}
and~\ref{eq:rate_density_shape} the occurrence rate density at a planet radius 
$r$ can be written
\begin{equation}
\Gamma(r) = \delta(r_p) \times
\frac{
    N_0 Z_0 +
    N_1 Z_1 +
    N_2 Z_2
}{N_{\rm tot}},
\label{eq:model_1_rate_density}
\end{equation}
where $\delta(r_p)$ is the Dirac delta function, zero except at the true 
planet radius, $r_p$.
The occurrence rate over any interval that includes $r_p$ is then
\begin{equation}
\Lambda|_{r_p} = \frac{
    N_0 Z_0 +
    N_1 Z_1 +
    N_2 Z_2 
}{N_{\rm tot}},
\label{eq:model_1_rate}
\end{equation}
and the rate is zero over intervals that do not include $r_p$.

We return to our group of binarity-ignoring astronomers. They do 
not know the true rate density~--~they would like to discover it!
In their signal-to-noise limited transit survey, they select stars 
that they think can yield transit detections.
Since the noise is Poissonian, they assume
\begin{equation}
\frac{{\rm signal}}{{\rm noise}}
\propto \frac{(r/R)^2}{F^{-1/2}}
\propto F^{1/2}
\propto L_{\rm sys}^{1/2} d^{-1}, \quad ({\rm incorrectly\ assumed})
\end{equation}
for $R$ the constant stellar radius, $F$ the photon flux, $L_{\rm sys}$ the 
luminosity of a system, and $d$ its distance from us.
At fixed planet radius, semimajor axis, stellar radius, and stellar luminosity,
a constant signal-to-noise floor yields a maximum detectable 
distance~\citep{pepper_using_2003,pepper_searching_2005}.
The maximum distance out to which our binarity-ignoring astronomers 
select stars, $d_{\rm sel}$, thus scales as $L_{\rm sys}^{1/2}$.

The single stars have luminosity $L_1$, and the twin binaries have luminosity 
$2L_1$.
Thus the twin binaries are selected out to a distance $\sqrt{2}$ times 
that of single stars.
This is a bad move, because the transit signal for any planet in a 
twin binary will be diluted by a factor of two:
\begin{equation}
\frac{{\rm signal}}{{\rm noise}}
\propto \frac{\mathcal{D} (r/R)^2}{F^{-1/2}}
\propto \mathcal{D} F^{1/2}
\propto \mathcal{D} L_{\rm sys}^{1/2} d^{-1}, \quad ({\rm true})
\label{eq:snr_true}
\end{equation}
where the dilution is $\mathcal{D} \equiv L_{\rm host}/L_{\rm sys}$, for 
$L_{\rm host}$ the the planet host's luminosity.
This means that the true maximum searchable distance for binaries, $d_{\rm 
    det}$, is $1/\sqrt{2}$ times that of single stars.
The situation is illustrated in Fig.~\ref{fig:model_1_volumes}: only one in 
eight selected stars in binaries are truly searchable.

\begin{figure}[!tb]
    \begin{center}
        \includegraphics[width=0.6\textwidth]{figures/visualize_volumes.pdf}
    \end{center}
    \caption{
        Cartoon of the searchable volumes for single stars ({\it left}), and 
        twin binaries ({\it right}).
        This model (\#1) assumes all stars have equal mass and luminosity, and 
        all planets have the same true radius $r=r_p$.
        {\it Top:} At an apparent radius $r\a=r_p$,
        the observer selects twin binaries out to a larger         
        distance, $\sqrt{2}\times$ that of single stars.
        Because of dilution, there are no planets in twin binaries with 
        $r\a=r_p$.
        {\it Middle:} At an apparent radius $r\a=r_p/\sqrt{2}$, the 
        searched volumes are half those at $r\a=r_p$. 
        The only detected planets with $r\a=r_p/\sqrt{2}$ orbit twin binaries.
        {\it Bottom:} Planets with a true radius $r=r_p$ are searchable to 
        a maximum distance $d_0$ around singles, and $d_0/\sqrt{2}$ around 
        twin binaries. These distances are the same as what an observer 
        selects based on apparent radii.
    }
    \label{fig:model_1_volumes}
\end{figure}


\paragraph{What do the observers ignoring binarity infer?} 
The binarity-ignoring observers assume that all points on the sky with flux 
above some minimum are searchable.
They correct their assumed number of searchable stars for the transit 
probability.
As a function of apparent radius, they then report an apparent rate density of
\begin{equation}
\Gamma_a(r_a) = 
\delta(r_p) Z_0 \frac{N_0}{N_0+N_1}  +
\delta\left(\frac{r_p}{\sqrt{2}}\right) 
(Z_1 p_{{\rm det},1} + Z_2 p_{{\rm det},2}) \frac{N_1}{N_0+N_1},
\label{eq:model_1_apparent_rate_density}
\end{equation}
where $p_{{\rm det},1}$ ($p_{{\rm det},2}$) is the probability that a selected 
primary (secondary) is searchable.
In this example, $p_{{\rm det},1}=p_{{\rm det},2}=1/8$; the detection 
efficiency is the ratio of the searchable to selected volumes.

The true rate density (Eq.~\ref{eq:model_1_rate_density}) and the
apparent rate density (Eq.~\ref{eq:model_1_apparent_rate_density})
differ in that
\begin{enumerate}
    \item The total number of selected stars, $N_{\rm tot} = N_0+N_1+N_2$, was 
    miscounted.
    %
    \item The detection efficiency was incorrectly assumed to be $1$ for all 
    selected stars. In reality, only one in eight binaries were searchable.
    %
    \item The inferred radii in binary systems are all $\sqrt{2}$ too small.
\end{enumerate}

To assess the severity of these errors, we need to make assumptions about the 
stellar and planetary populations.
The important quantity for the stellar population is $N_1/N_0$, the ratio of 
selected primaries (or binaries) to singles. We can define
\begin{align}
\mu \equiv \frac{N_1}{N_0} &=
\frac{n_b}{n_s} \left(\frac{d_{\rm sel,b}}{d_{\rm sel,s}}\right)^3 = 
\frac{{\rm BF}}{1-{\rm BF}} (1+\ell)^{3/2},
\label{eq:mu_definition}
\end{align}
where $n_b$ and $n_s$ are the number density of binaries and singles in a 
volume limited sample, and the maximum selected distance for binary and single 
systems are $d_{\rm sel,b}$ and $d_{\rm sel,s}$.
The light ratio $\ell$ is defined relative to the primary, so that
$L_{\rm sys} = L_1(1+\ell)$.
The binary fraction in a volume limited sample is ``{\rm BF}''.
For instance, \citet{raghavan_survey_2010} found a multiplicity 
fraction\footnote{
    The binary fraction is the fraction of systems in a volume-limited sample 
    that are binary. It is equivalent to the multiplicity fraction if there 
    are no triple, quadruple, or higher order multiples. In that case, ${\rm 
        BF} = n_b / (n_s+n_b)$.
} of 0.44 for primaries with masses from $0.7M_\odot$ to $1.3M_\odot$. 
``Twin binaries'' are perhaps 10-20\% of the binaries in a volume-limited 
sample, depending on how ``twin'' is defined.
Thus a representative twin binary fraction for this model is ${\rm BF}\approx 
0.05$-$0.1$. 

Further, we need to assume knowledge of the true number of planets per 
single, primary, and secondary star ($Z_0,Z_1,$ and $Z_2$).
Taking $Z_0=Z_1=Z_2=1/2$, we plot the resulting occurrence rates as a function 
of planet radius in Fig.~\ref{fig:occ_rate_model_1}.
Though it is impossible for an observer to isolate any one of binarity's 
biases without also addressing the others, mathematically it is simply a 
matter of modifying the appropriate terms in 
Eq.~\ref{eq:model_1_apparent_rate_density}.
The resulting rates are also shown in 
Fig.~\ref{fig:occ_rate_model_1}, and demonstrate how each 
error individually affects the overall inferred rate.

\begin{figure}[!tb]
    \begin{center}
        \includegraphics[width=.6\textwidth]{figures/occ_rate_vs_radius_model_1_brokenx.pdf}
    \end{center}
    \vspace{-0.5cm}
    \caption{
        Inferred occurrence rates over $0.01r_\oplus$ bins in planet 
        radius,for Model \#1.
        This model has fixed stars, fixed planets, and twin binaries. 
        Further, a twin binary fraction of ${\rm BF}=0.1$ is assumed, and all 
        planets are {\bf TODO}.
        If the true planet radius is $r_p$, all planets detected in binaries 
        will have apparent radii $r_a = r_p/\sqrt{2}$.
    }
    \label{fig:occ_rate_model_1}
\end{figure}


\paragraph{Correction to inferred rate density and inferred rate}

We define a rate density correction factor, $X_\Gamma$, as the ratio of the 
apparent to true rate densities:
\begin{equation}
X_\Gamma \equiv \frac{\Gamma_a}{\Gamma}.
\end{equation}
This correction factor can be a function of whatever parameters $\Gamma_a$ and 
$\Gamma$ depend on; in this study, the planet radius is most relevant.

If we continue assuming that the number of planets per single, primary, and 
secondary star are equal ($Z_0=Z_1=Z_2$), we find a rate density correction 
factor at the true planet radius of
\begin{equation}
X_\Gamma(r_p) = \frac{1}{1+\mu},
\label{eq:Z_eq_model_1_correction}
\end{equation}
This yields a correction of 0.76 if ${\rm BF}=0.1$, and 0.87 if ${\rm 
    BF}=0.05$.
Rephrasing the result, if the twin binary fraction were 
$(2^{3/2}+1)^{-1}\approx 0.26$, then the apparent rate would be half the true 
rate.
Fortunately, in most contexts the twin binary fraction is not that high.

An alternative assumption is that secondaries do not host planets. In that 
case, $Z_0=Z_1$, and $Z_2=0$. The correction to the rate density at the true 
planet radius becomes
\begin{equation}
X_\Gamma(r_p) = \frac{1+2\mu}{(1+\mu)^2}.
\end{equation}
This evaluates to 0.94 if ${\rm BF}=0.1$, and 0.98 if ${\rm BF}=0.05$.
While it is hard to justify the assumption that secondaries are planet-less, 
it is worth noting that $\Gamma_a/\Gamma$ is sensitive to the relative number 
of planets per single, primary, and secondary.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Model \#2: fixed planets and primaries, varying secondaries}
\label{sec:model_2}

\begin{figure}[!tb]
    \centering
    \includegraphics[width=0.6\textwidth]{figures/mass_ratio_distribution.pdf}
    \caption{
        The mass ratio distribution for a magnitude-limited sample of 
        binary stars, in which the underlying volume-limited distribution is 
        uniform (qualitatively similar to {\it 
            e.g.},~\citet{raghavan_survey_2010}'s Fig.~16).
        The entire bias can be understood analytically 
        (Eq.~\ref{eq:Malmquist_bias}).
    }
    \label{fig:q_distribn_mag_limited}
\end{figure}

Our binary-twin model provides a simple estimate of binarity's systematic 
effects, but perhaps it is too simple.
We begin introducing realism by first letting the light ratio $\ell = L_2/L_1$ 
vary across the binary population.
It does so because the underlying mass ratio $q=M_2/M_1$ varies.
We keep the primary mass fixed as $M_1$, which is also the mass of all single 
stars.

We parametrize the distribution of binary mass ratios in a volume-limited 
sample as a power law: $p(q)\propto q^\beta$.
For binaries with solar-type primaries\footnote{
    \citet{duchene_stellar_2013}, fitting all the multiple systems of 
    \citet{raghavan_survey_2010}'s Fig 16, find $\beta = 0.28\pm0.05$ for 
    $0.7<M_\star/M_\odot<1.3$.
    Examining only the binary systems of \citeauthor{raghavan_survey_2010}'s 
    Fig 
    16, the distribution seems (by eye) to be roughly uniform, $\beta \approx 
    0$, 
    except for an excess of twin binaries with $q\approx 1$, and an obvious 
    lack of $q<0.1$ stellar companions.
}, $\beta$ is probably between 0 and 0.3.
We further assume that stars are a one-parameter family, $R \propto M \propto 
L^{1/\alpha}$, so that a drawn value of $q$ determines everything about a 
secondary.

The rate density in this model, $\Gamma(r,q)$, is the sum of the rate 
densities for each system type:
\begin{equation}
\Gamma(r,q)
=
\delta(r_p) \times 
\frac{N_0 Z_0 + N_1 Z_1 + N_2 Z_2 p_2(q)}{N_{\rm tot}}
\label{eq:model2_rate_density}
\end{equation}
where $p_2(q)$ is mass-ratio dependent shape function in secondaries. A fully 
general approach would parametrize $p_2(q)$ as a power law, $p_2(q) \propto 
q^\gamma$. For simplicity we will always take $\gamma=0$, the uniform case.
%We have written $\Gamma$ in terms of the mass ratio instead of the 
%secondary star's radius for convenience ($q$ and $R_2$ are interchangeable).
The interpretation of $Z_i$ is still ``the number of planets per star of 
type $i$'', but now for secondaries this must include a marginalization 
over both the mass ratio and the planet radius.

There is also a Malmquist bias in Eq.~\ref{eq:model2_rate_density}, hidden 
away in the numbers of selected stars.
This is because the selected sample at a fixed planet radius and period is 
magnitude-limited.
Given a binary, the probability of drawing a mass ratio $q$ in a 
magnitude-limited sample scales as
\begin{equation}
p({\rm draw\ }q\,|\,{\rm system\ is\ binary}) \propto q^\beta 
(1+q^\alpha)^{3/2}
\label{eq:Malmquist_bias}
\end{equation}
where $q^\beta$ is the volume-limited probability of drawing a binary of mass 
ratio $q$, and the latter term is the Malmquist bias.
We show the magnitude-limited mass ratio distribution for the $\beta=0$ case 
in Fig.~\ref{fig:q_distribn_mag_limited}.
We emphasize that in Monte Carlo simulations of transit surveys, it is 
important to draw binaries from the correctly biased mass-ratio distribution 
\citep[\textit{e.g.},][]{bakos_hatsouth:_2013,sullivan_transiting_2015,
    gunther_new_2017}.

The occurrence rate corresponding to Eq.~\ref{eq:model2_rate_density}'s rate 
density for specific mass ratios of interest $q_{\rm min} < q < q_{\rm 
    max}$ is then
\begin{equation}
\Lambda|_{r_p,q_{\rm min},q_{\rm max}} = 
\frac{N_0 Z_0 + N_1 Z_1 + N_2 Z_2 f_2}
{N_{\rm tot}},
\end{equation}
for
\begin{equation}
f_2 \equiv
\int_{q_{\rm min}}^{q_{\rm max}} p_2(q) \,{\rm d}q,
\end{equation}
where $p_2(q)\propto q^\gamma$, and is normalized to unity.


\paragraph{What do the observers ignoring binarity infer?}
As a reminder, the binary-ignoring observers compute an apparent rate density 
by correcting the number of detections per star for the transit probability 
and the detection efficiency.
In this process, they make the following errors:
\begin{enumerate}
    \item They assume that they have selected $N_0+N_1$ stars, while they have 
    actually selected $N_0+N_1+N_2$.
    %
    \item They assume that every star within the maximum selected distance is 
    searchable.
    This is true for single stars.
    For binaries, the actual detection efficiency is the ratio of the number 
    of 
    searchable stars to the number of selected stars.
    For primaries,
    \begin{equation}
    p_{\rm det,1} = \left(\frac{d_{\rm det,1}}{d_{\rm sel}}\right)^3
    = \mathcal{D}_1^3 = (1+q^\alpha)^{-3},
    \label{eq:model_2_p_det_1}
    \end{equation}
    where we have assumed that all single stars and primaries have the same 
    properties, and have used $\ell = q^\alpha$.
    For secondaries,
    \begin{equation}
    p_{\rm det,2} = \left(\frac{d_{\rm det,2}}{d_{\rm sel}}\right)^3
    = \mathcal{D}_2^3 \left(\frac{R_1}{R_2}\right)^6
    \left(\frac{T_{\rm dur,2}}{T_{\rm dur,1}}\right)^{3/2} 
    = (1+q^{-\alpha})^{-3} q^{-5},
    \label{eq:model_2_p_det_2}
    \end{equation}
    where subscripts `1' and `2' correspond to primaries and secondaries, and 
    we 
    used the scaling relation $T_{\rm dur}\propto \rho_\star^{-1/3} \propto 
    R_\star^{2/3}$.
    %
    \item They assume a transit probability for all stars of $p_{\rm tra} = 
    R_\star/a$. 
    For planets orbiting secondaries at fixed period, the true transit 
    probability 
    is $q^{2/3} p_{\rm tra}$, since the secondaries have smaller radii and 
    masses.
    %
    \item The true planetary radii $r$ are interpreted as apparent radii $r_a$.
    In binaries, the apparent radii depend on whether the host is the primary 
    or 
    secondary:
    \begin{align}
    r_a
    &=
    \left.
    \begin{cases}
    r_p (1+q^\alpha)^{-1/2} & \text{for } i=1,\ {\rm primary} \\
    r_p (1+q^{-\alpha})^{-1/2} q^{-1}, & \text{for } i=2,\ {\rm secondary}.
    \end{cases}
    \right.
    \label{eq:model2_ra}
    \end{align}
    The factor of $q^{-1}$ for the secondary case accounts for the observer 
    assuming all transit signals come from stars of fixed size.
\end{enumerate}

To write the apparent rate density as a function of the apparent 
radius $r_a$, we marginalize out the planet period, semimajor axis, and 
stellar radius (or equivalently the mass ratio, for binaries):
\begin{equation}
\Gamma_a(r_a) =
\frac{N_0}{N_0+N_1} Z_0 \delta(r_p)
+
\frac{N_1}{N_0+N_1} \left( Z_1 I_1(r_a)
+
Z_2 I_2(r_a) \right).
\label{eq:model2_Gamma_a}
\end{equation}
The ratio of primaries to singles, $\mu=N_1/N_0$, is now less than 
that of Model \#1 (cf. Eq.~\ref{eq:mu_definition}). This is because a 
distribution of light 
ratios $\ell$ leads to a distribution of maximum selected distances. 
Integrating over the mass ratios from $q=0$ to $1$, one finds a
dimensionless integral
\begin{equation}
\mu \equiv \frac{N_1}{N_0} = \frac{\rm BF}{1 - {\rm BF}} \left(2^{3/2} - 
\int_{1}^{\sqrt{2}} u^2 (u^2 -1)^{1/\alpha} \,{\rm d}u\right).
\label{eq:mu_model_2}
\end{equation}

Given a binary fraction, Eq.~\ref{eq:mu_model_2} fully specifies the 
``weights'' in Eq.~\ref{eq:model2_Gamma_a}.
The $I_1(r_a)$ and $I_2(r_a)$ terms are found by marginalizing over the joint 
distribution of apparent radius and mass ratio:
\begin{align}
I_i(r_a) &= 
\int_0^1 p({\rm has\ detected\ planet}, r_a, q | {\rm star\ is\ type\ }i)
\,{\rm d}q,
\quad
{\rm for}\ i\in\{1, 2\}, \\
&=
\int_0^1 
p({\rm has\ detected\ planet} | r_a, q, {\rm star\ is\ type\ }i) 
\nonumber\\
&\quad\quad\quad\quad\times p(r_a | q, {\rm star\ is\ type\ }i)
\,p(q | {\rm star\ is\ type\ }i)
\,{\rm d}q.
\end{align}
The first term is the detection efficiency; the second is a $\delta$-function 
of the apparent radius; the last is the mass ratio distribution given by 
Eq.~\ref{eq:Malmquist_bias}.
An analytic solution can be found for $i=1$.
For $i=2$ there is no analytic solution, because evaluating the integral 
requires imposing the constraint that $r_a  = r_p 
(1+q^{-\alpha})^{-1/2}q^{-1}$. This equation can be re-written
\begin{equation}
\left(\frac{r_p}{r_a}\right)^2 = q^2 + q^{-\alpha + 2},
\end{equation}
which has no analytic solution for $q(r_a)$ except for special values of 
$\alpha$, the mass-luminosity exponent.
For $\alpha=3.5$, our nominal case, semianalytic solutions do exist.
However, since our main interest is in understanding the qualitative behavior 
of the solutions, we derive a limiting case, and then proceed 
numerically.

\begin{comment}
The analytic solution for $i=1$ is something like
\begin{equation}
I_1(r_a) = \frac{1}{\mathcal{N}_1} \left(\frac{r_p}{r_a}\right)^{-3}
\left( \left(\frac{r_p}{r_a}\right)^2 -1  
\right)^{\frac{\gamma+\beta}{\alpha}},
\quad {\rm for}\ r_p/\sqrt{2} < r_a < r_p,
\end{equation}
where $\mathcal{N}_1$ is the normalization term of the binary mass ratio 
distribution (Eq.~\ref{eq:model_2_p_2}): $\mathcal{N}_1 = \int_0^1 
q^{\gamma+\beta} (1+q^\alpha)^{3/2} {\rm d}q$.
\end{comment}




\paragraph{Limiting case of rate density correction}
Recall that the rate density correction factor, $X_\Gamma$, is the ratio of 
the apparent to true rate densities.
We consider a ``nominal model'' in which the stellar population is similar to 
Sun-like stars in the local neighborhood:
${\rm BF}=0.44$, $\alpha=3.5$, $\beta=0$.
Our default assumption is also that the occurrence of planets is independent 
of stellar mass ($\gamma=0$), so secondaries have the same occurrence rate as 
primaries and single stars.
Under these assumptions, the true rate density is
\begin{equation}
\Gamma(r) \approx \delta(r_p) \left( Z_0 + Z_1 + 
Z_2 \right) / 3,
\label{eq:model2_Gamma_r}
\end{equation}
where the coefficients of $1/3$ are accurate to within one percent of the true 
coefficients.
Ignoring binarity, the observer finds an apparent rate density
\begin{equation}
\Gamma_a(r) = c_0 Z_0 \delta(r_p)
+c_1 Z_1 I_1(r_a)
+c_2 Z_2 I_2(r_a),
\label{eq:model2_Gamma_a_r}
\end{equation}
for $c_0\approx 0.49$, and the coefficients $c_1, c_2$ unknown.
%171011_integrals.nb $c_1\approx 0.32$
We can evaluate the correction term at $r=r_p$, since $\lim_{r_a\rightarrow 
    r_p} I_i(r_a)=0$ for $i\in\{1,2\}$:
\begin{equation}
X_\Gamma(r=r_p) \approx \frac{3c_0 \Lambda_0}{\Lambda_0+\Lambda_1+\Lambda_2}.
\end{equation}
If all the $Z_i$'s are equal, $X_\Gamma(r=r_p)\approx0.49$.
If there are no planets around the secondaries, $X_\Gamma(r=r_p)\approx0.74$.

\begin{figure}[!h]
\centering
\includegraphics[width=.6\textwidth]{figures/occ_rate_vs_radius_logs_model_2.pdf}
\caption{
Inferred planet occurrence rates as a function of planet radius in Model \#2. 
This model has fixed planets and primaries, and varying secondary masses, 
radii, and luminosities.
}
\label{fig:occ_rate_model_2_log}
\end{figure}


\paragraph{Numerical approach}
To maintain simplicity, we develop a Monte Carlo program to simulate our 
toy transit surveys.
The program generates a stellar population, assigns planets to the stars, and 
then calculates which planets are detectable.
It then computes the apparent and true planet occurrence rates as a function 
of planet radius.
We discuss the details below, and refer the interested reader to our online 
implementation\footnote{\url{https://github.com/lgbouma/binary_biases}}.

First, the user must specify the free parameters that describe the 
stellar and planetary population. These values include the binary fraction, 
and the true planet occurrence rates around single stars, primaries, and 
secondaries (the $Z_i$'s; recall Eq.~\ref{eq:rate_density_shape}).
There is also an arbitrary absolute number of selected stars.

Once the user specifies the free parameters, the program constructs a 
population of selected stars.
Each selected star is assigned a type (single, primary, secondary), a 
binary mass ratio (if it is not single), and the property of whether it is 
``searchable''.
The relative number of binaries to primaries is set by 
Eq.~\ref{eq:mu_model_2}.
The mass ratios are drawn from the appropriate magnitude-limited distribution 
(Eq.~\ref{eq:Malmquist_bias}).
If it is single, a selected star is assumed to be searchable.
If it is a primary or secondary, its searchability is determined by a uniform 
draw from either Eq.~\ref{eq:model_2_p_det_1} or Eq.~\ref{eq:model_2_p_det_2}, 
as appropriate. 

Assigning planets, each selected star receives a planet at the rate $Z_i$, 
according to its type.
The radii of planets are assigned independently of any host system property, 
and can be sampled for an arbitrary distribution ({\it e.g.}, power law; delta 
function).
The absolute transit probability, $p_{\rm tra}$ is set arbitrarily, and the 
probability of a planet transiting a secondary is set as $q^{2/3}\times p_{\rm 
    tra}$.
A planet is ``detected'' when a) it transits, and b) its host star is 
searchable.
For detected planets, apparent radii are computed according to analytic 
formulae that account for both dilution and the misclassification of stellar 
radii (Eq.~\ref{eq:model2_ra}).
We assume that the observers think that all transits are around single stars.

We then compute rates in bins of true planet radius and apparent planet radius.
In a given radius bin, the true rate is found by counting the number of planets
that exist around selected stars of all types (singles, primaries,
secondaries), and dividing by the total number of these stars.
The apparent rates are found by counting the number of detected planets that
were found in an apparent radius bin, dividing by the geometric transit
probability for single stars, and dividing by the apparent total number of
stars.


\paragraph{Numerical results for Model \#2}
We first validate our model by ensuring it produces the analytically-predicted 
results for Model \#1, and the limiting case of Model \#2 described above.
Following validation, we assume ${\rm BF}=0.44$, $\alpha=3.5$, 
$\beta=\gamma=0$, and take $Z_0=Z_1=Z_2=0.5$. We then compute the true and 
apparent occurrence rates over bins in planet radius.
The results are shown in Fig.~\ref{fig:occ_rate_model_2}.
Evidently, dilution produces a spectrum of apparent planetary radii. This 
leads to overestimated rates everywhere except where at the true planet 
radius, where the rate is underestimated by a factor of two.
Compared to Model \#1 (Fig.~\ref{fig:occ_rate_model_1}), the general picture 
is that the apparent radius distribution is ``blurred'' by the varying 
secondary light ratios.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Model \#3: Fixed primaries, varying planets and secondaries}
\label{sec:model_3}

As in the previous model, all single and primary stars in this model have 
identical properties.
The secondaries have masses, radii, and luminosities that vary between 
systems: $M\propto R \propto L^{1/\alpha}$.
The only addition is that we now let the radii of planets vary: they are 
assigned independently of any host system property, and are sampled from the 
true radius distribution, which we take as
\begin{align}
p_r(r)
&\propto
\left.
\begin{cases}
r^\delta & \text{for } r\geq 2r_\oplus \\
{\rm constant} & \text{for } r\leq2r_\oplus.
\end{cases}
\right.
\label{eq:model3_radius_distribution}
\end{align}
Following~\citet{howard_planet_2012}'s measurement, we take $\delta = -2.92$.
Our ``nominal model'' remains the same: the binary fraction is 0.44, 
$\alpha=3.5$, $\beta=\gamma=0$.
We take $Z_i$, the number of planets per single, primary, and secondary, to be 
equal.

For this model, we forgo analytic development and simply run our Monte Carlo 
program\footnote{
    One might worry that our Monte Carlo program does not increase the number 
    of 
    selected stars as the square of the planet radius (Eq.~\ref{eq:snr_true}).
    We can omit this dependence because in our model $N_1/N_0$ is independent 
    of 
    desired planet radius, and all other terms in the rate densities ({\it 
    e.g.}, 
    Eqs.~\ref{eq:model2_rate_density} and~\ref{eq:model2_Gamma_a}) are 
    independent 
    of the number of selected stars.
}.
The resulting occurrence rates are shown in 
Fig.~\ref{fig:occ_rate_model_3_log}.
For the assumed planetary and stellar distributions, the inferred rate is 
underestimated over all radii.

\begin{figure}[!tb]
\centering
\epsscale{1.15}
\plottwo{figures/int_rate_density_vs_radius_model_3_rpu_22.5_manyZs.pdf}{figures/int_occ_rate_vs_radius_model_3_rpu_22.5_manyZs.pdf}
\caption{
{\it Left:} rate density and {\it right:} rate as a 
function of planet radius in Model \#3. This model has fixed primaries and 
single stars, but varying secondaries. The true planet radius distribution is 
a power law with exponent $-2.92$ above $2r_\oplus$, below which it is uniform 
\citep[similar to][]{howard_planet_2012}.
\label{fig:occ_rate_model_3_log}}
\end{figure}


\paragraph{Hot Jupiter occurrence rates}
Taking Fig.~\ref{fig:occ_rate_model_3_log} and counting the number of planets 
per star with $r>8r_\oplus$, we can compare the true and inferred hot Jupiter 
occurrence rates.
Under the above assumptions, the true rate is 9.1 hot Jupiters 
per thousand stars.
The inferred rate is 6.9 per thousand stars.
This means that the inferred rate underestimates the true rate by a 
multiplicative factor of $\sim\!1.3$.

However, this result only applies under the assumption that $Z_0 = 
Z_1 = Z_2$.
If hot Jupiters are less common around lower mass stars, it would be more 
sensible to consider $Z_2<Z_0$, while letting single stars and 
primaries host planets at the same rate.
Therefore in Fig.~\ref{fig:HJ_correction_inputrate_vs_HJratevalues} we let 
$Z_2$ vary, and show the resulting inferred and true hot Jupiter 
($r>8r_\oplus$) rates.
The result is that the inferred rate is nearly independent of 
$Z_2$~--~this is because most ($<1/10$) secondaries are not searchable, 
and so their completeness fraction is much smaller than that of primaries or 
single stars.
This means far fewer detected hot Jupiters orbit secondaries, and so they 
hardly affect the inferred rate.
While the ``true rate'' across the entire population is linearly dependent on 
$Z_2$, the rate around 
singles and primaries (Fig.~\ref{fig:HJ_correction_inputrate_vs_HJratevalues} 
green line) is independent of that around secondaries.



\paragraph{The rate of Earth analogs}
This model provides an estimate of the apparent and true 
rates as a function of radius (Fig.~\ref{fig:occ_rate_model_3_log}).
At Earth's radius, the result is that the inferred rate is $0.84\times$ the 
true rate around single stars, assuming that the $Z_i$'s are equal.
Similar to the above case of the hot Jupiters, if we vary the true $Z_2$ 
while keeping $Z_0 = Z_1$, the ratio of the inferred to true rate 
around single stars changes by only a few percent (shown in 
Fig.~\ref{fig:earth_inputrate_vs_etaearthratevalues}).
The ratio of the inferred to the true rate, $(\Lambda_{\rm 
    inferred}/\Lambda)_{r=r_\oplus}$ varies substantially, but by at most 
$50\%$ 
in the (unrealistic) limiting case that secondaries do not host planets.

%TODO: FIGURE OUT WHAT TO DO WITH THESE
\begin{comment}
\begin{figure}[!tb]
    \centering
    \includegraphics[width=.6\textwidth]{figures/HJ_correction_inputrate_vs_HJratevalues.pdf}
    \caption{
        $Z_i$ is the occurrence rate integrated over all possible phase 
        space for the $i^{\rm th}$ system type. $Z_2/Z_0=1$ 
        corresponds to an equal number of planets per secondary as per single 
        star;
        $Z_2/Z_0=0$ corresponds to secondaries not having any 
        planets.
        In our Model \#3, though the true HJ occurrence rate 
        is highly dependent on $Z_2$, 
        the inferred rate hardly depends on whether secondaries have HJs.
        This means that the ``correction factor'' between the inferred rate 
        and the true rate around single stars is underestimated by a 
        multiplicative 
        factor of $\approx1.3$, independent of the HJ rate around secondaries.
        The ``HJ rate'' is the summed rate from     
        Fig.~\ref{fig:occ_rate_model_3_log} above $8r_\oplus$.
    }
    \label{fig:HJ_correction_inputrate_vs_HJratevalues}
\end{figure}


\begin{figure}[!tb]
    \centering
    \includegraphics[width=.6\textwidth]{figures/earth_inputrate_vs_etaearthratevalues.pdf}
    \caption{
        Same as Fig.~\ref{fig:HJ_correction_inputrate_vs_HJratevalues}, but 
        for Earth-sized planets.
        The absolute values given on the $y$-axis found by summing the rate 
        from Fig.~\ref{fig:occ_rate_model_3_log} for planetary radii from 
        $0.5$ to $1.5r_\oplus$ (this is a toy model, and they do not reflect 
        an actual determination of $\eta_\oplus$).
        The relative values show that the inferred rate for Earths is roughly 
        independent of the occurrence rate (integrated over all radii) around 
        secondaries.
        However, it is systematically lower than the true rate around single 
        and primary stars, by $\approx 20\%$.
    }
    \label{fig:earth_inputrate_vs_etaearthratevalues}
\end{figure}
\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\input{discussion}

\section{Discussion}
\label{sec:discussion}

\paragraph{How has binarity been considered in occurrence rate measurements?}
Binarity introduces systematic uncertainty to star and planet counts, and also 
to estimates of pipeline completeness.
In spite of this fact, stellar multiplicity has mostly been ignored in 
calculations of planet occurrence rates using transit survey data\footnote{
    A list of occurrence rate papers is maintained at 
    \url{https://exoplanetarchive.ipac.caltech.edu/docs/occurrence_rate_papers.html}
}~
\citep[\textit{e.g.},][]{howard_planet_2012,fressin_false_2013,foreman-mackey_exoplanet_2014,dressing_occurrence_2015,burke_terrestrial_2015}.
For {\it Kepler} occurrence rates specifically, it seems that no one has yet 
carefully assessed binarity's importance, or lack thereof.
While we do not resolve the problem, we do suggest
the approximate scale of the necessary corrections in a survey-independent 
manner.

Of course, on a system-by-system level stellar multiplicity affects the 
interpretation of planet candidates. High resolution imaging 
campaigns have measured the multiplicity of almost all {\it Kepler}\ Objects 
of Interest 
\citep{howell_speckle_2011,adams_adaptive_2012,adams_adaptive_2013,horch_observations_2012,
    horch_most_2014,lillo-box_multiplicity_2012,lillo-box_high-resolution_2014,dressing_adaptive_2014,
    law_robotic_2014,cartier_revision_2015,everett_high-resolution_2015,gilliland_hubble_2015,
    wang_influence_2015,wang_influence_2015-1,baranec_robo-ao_2016}.
The results of these programs have been collected 
by~\citet{furlan_kepler_2017}, and they represent an important advance in 
understanding the KOI 
sample's multiplicity statistics.
In particular, they can be immediately applied to rectify binarity's effects 
on the mass-radius diagram~\citep{furlan_densities_2017}.

The high resolution imaging campaign is also beginning to connect with
occurrence rate calculations.
The most recent rate studies have used~\citet{furlan_kepler_2017}'s 
catalog to test the effects of removing KOI hosts with known companions, which 
helps reduce contamination in the ``numerator'' of 
the occurrence rate (\citealt{fulton_california-_2017}; Petigura et al.\! 2018,
in preparation).
However, without an understanding of the multiplicity statistics of the 
non-KOI stars, the true completeness, and thus the true 
occurrence rates, will remain biased.
The first-order correction that we suggest, given the impracticality of 
performing high-resolution imaging of every selected star in a transit survey,
is to model the detection pipeline's efficiency while accounting for 
binarity.
%Simply put~--~do not assume binarity can be ignored, and take the relevant 
%systematic uncertainties about the selected stars into account.
For {\it Kepler}, this would require high resolution imaging of a
comparison sample of non-KOI host stars. If the associated multiplicity 
statistics are then included in a model of the pipeline's detection 
efficiency, and the number of selected stars is appropriately counted, it 
would correct most of binarity's biases.


\paragraph{The hot Jupiter rate discrepancy}
\begin{figure}[!tb]
    \centering
    \includegraphics[width=.6\textwidth]{figures/int_rate_density_vs_radius_model_7_rpu_22.5_manyZs.pdf}
    \caption{
        HJ rate, if it were Gaussian.
    }
    \label{fig:gaussian_HJ}
\end{figure}

There is at least one context in which ignoring binarity may already be 
leading to discrepant measurements.
Hot Jupiter occurrence rates measured by transit surveys ($\approx 0.5\%$) are 
marginally lower than those found by radial velocity surveys ($\approx 1\%$; 
see Table~\ref{tab:hj_rates}).
Though the discrepancy has weak statistical significance ($<3\sigma$),
one reason to expect a difference is that the corresponding stellar 
populations have distinct metallicities.
As argued by \citet{gould_frequency_2006}, the RV sample is biased towards 
metal-rich stars, which have been measured by RV surveys to preferentially 
host more giant 
planets~\citep{santos_spectroscopic_2004,fischer_planet-metallicity_2005}.
Investigating the discrepancy from the metallicty 
angle,~\citet{guo_metallicity_2017} measured the
{\it Kepler} field's mean metallicity to be $[{\rm M/H}]_{\rm Kepler}= 
-0.045\pm0.009$, which is lower than the California Planet Search's mean of 
$[{\rm M/H}]_{\rm CPS}= -0.005\pm0.006$.
The former value agrees with that measured by \citet{dong_metallicities_2014}.
Based on their measurements, \citeauthor{guo_metallicity_2017}\! 
then argued that the metallicity difference could account for a $\approx 20\%$ 
relative difference in the measured rates between the CKS and {\it Kepler}\ 
samples~--~not a factor of two.
\citeauthor{guo_metallicity_2017}\! concluded that ``other factors, such as 
binary contamination and imperfect stellar properties'' must also be at play.

Aside from surveying stars of varying metallicities, radial velocity and 
transit surveys differ in how they treat binarity.
Radial velocity surveys typically reject both visual and spectroscopic binaries
\citep[\textit{e.g.},][]{wright_frequency_2012}.
Transit surveys typically observe binaries, but the question of whether they 
were searchable to begin with is left for later interpretation.
In spectroscopic follow-up of candidate transiting planets, the prevalence of 
astrophysical false-positives may also lead to a bias against confirmation of 
transiting planets in binary systems.

Ignoring these complications, in this work we showed that
binarity biases transit survey occurrence rates through its effects on 
completeness, star counts, and the apparent radii of detected planets.
Specifically, our results from Sec.~\ref{sec:model_3} indicate that binarity 
could lead to underestimated HJ rates by a multiplicative factor of $\approx 
1.3$.

To assess the effect this might have towards resolving the hot Jupiter rate 
discrepancy we ask:
what is the probability of \citet{wright_frequency_2012}'s result, given a 
rate drawn from the stated bounds of Petigura et al.~(2018, in preparation)?
In other words, we first take the true HJ rate per thousand stars as 
$\Lambda_{\rm HJ} = 5.7 \pm 1.3$, with Gaussian uncertainties. 
We then draw from a Poisson distribution and compute the probability of 
detecting at least 10 hot Jupiters in a sample of 836 stars.
Without accounting for binarity or metallicity, only 4\% of RV surveys would 
detect at least 10 hot Jupiters.
If we multiply $\Lambda_{\rm HJ}$ by $1.2$ to account for 
~\citet{guo_metallicity_2017}'s measured metallicity difference between the 
{\it Kepler}\ field and the local solar neighborhood, 9\% of RV surveys would 
detect at least 10 hot Jupiters.
If we multiply once more by $1.3$ to account for binarity's bias, we find that
23\% of RV surveys would detect at least 10 hot Jupiters, and any discrepancy 
would be rather tenuous.
We emphasize that this result is only suggestive~--~a true resolution of the 
rate discrepancy would likely require a detailed understanding of the {\it 
    Kepler}\ field's multiplicity statistics.


\paragraph{The rate of Earth analogs}
Per {\it Kepler}'s primary science objective, the rate of Earth-like planets 
orbiting Sun-like stars has been independently measured by 
\citet{youdin_exoplanet_2011,petigura_prevalence_2013,dong_fast_2013,
    foreman-mackey_exoplanet_2014}, and \citet{burke_terrestrial_2015}.
These efforts have found that the one-year terrestrial planet occurrence rate 
varies between $\approx 0.03$ and $\approx 1$ per Sun-like star, depending on 
assumptions that are made when retrieving the rate 
(\citet{burke_terrestrial_2015}'s Fig.~17).
In our Model \#3, the inferred rate is $\approx 0.84\times$ the true rate 
around single stars.
This bias is quite small compared to the other systematic factors that 
currently dominate the dispersion in $\eta_\oplus$ measurements.
If a future analyses determine absolute values of $\eta_\oplus$ to 
better than a factor of two, binarity might merit closer attention.

One relevant caveat to our assessment of binarity's importance for 
$\eta_\oplus$ measurements is that none of our models 
included the rate density's period-dependence. However, close binaries usually
provoke dynamical instabilities, leading to fewer long-period planets per 
star~\citep[\textit{e.g.},][]{holman_long-term_1999,wang_influence_2014,
    kraus_impact_2016}.
This effect might further bias transit survey measurements of $\eta_\oplus$
beyond our rough estimate.



\paragraph{Precise features of the radius valley}


\begin{figure}[!tb]
    \centering
    \epsscale{1.15}
    \plottwo{figures/int_rate_density_vs_radius_model_4_xcut_manyZs.pdf}{figures/int_occ_rate_vs_radius_model_4_xcut_manyZs.pdf}
    \caption{
        {\it Left:} rate density and {\it right:} rate as a 
        function of planet radius in a model with a radius gap 
        (Eq.~\ref{eq:model4_radius_distribution}).
        Similar to Model \#3, this model has fixed primaries and single stars, 
        but varying secondaries.
    }
    \label{fig:model_4}
\end{figure}


Using improved stellar parameters measured by the California-{\it Kepler} 
survey,~\citet{fulton_california-_2017} recently reported a ``gap'' in 
the radius-period 
plane~\citep{petigura_california-kepler_2017,johnson_california-kepler_2017}.
The existence of the gap has been independently corroborated from a sample of 
KOIs with asteroseismically-determined stellar 
parameters~\citep{van_eylen_asteroseismic_2017}.
Precise measurement of the gap's features, in particular its width, 
depth, and shape, will require more accurate occurrence rates.
To illustrate binarity's role in the issue, we make identical assumptions as 
in Model \#3, but instead assume an intrinsic radius distribution
\begin{align}
p_r(r)
&\propto
\left.
\begin{cases}
r^\delta & \text{for } r\geq 2r_\oplus, \\
0 & \text{for } 1.5r_\oplus < r < 2r_\oplus, \\
{\rm constant} & \text{for } r\leq1.5r_\oplus.
\end{cases}
\right.
\label{eq:model4_radius_distribution}
\end{align}
The resulting true and inferred rates are shown in Fig.~\ref{fig:model_4}.
If left uncorrected, binarity makes the gap appear more shallow, and flattens 
the step-function edges.
At present though, binarity seems less important than other effects that would 
``blur'' the gap in the planet radius dimension. 
In particular, the valley's period-dependence is almost certainly not flat
\citep{van_eylen_asteroseismic_2017,owen_evaporation_2017}.
This means that any study assessing its width, depth, etc. only in the planet 
radius dimension must first account for the blurring that comes from 
marginalizing over the periods.



\paragraph{Does a detected planet orbit the primary or secondary?}
\citet{ciardi_understanding_2015} studied the effects of stellar multiplicity 
on the planet radii derived from transit surveys.
They modeled the problem for {\it Kepler}\ objects of interest by matching a 
population of binary and tertiary companions to KOI stars, 
under the assumption that the KIC-listed stars were the primaries.
They then computed planet radius correction factors assuming that {\it 
    Kepler}-detected planets orbited the primary or companion stars
with equal probability (their Sec. 5).
Under these assumptions, they found that any given planet's radius is on 
average underestimated by a multiplicative factor of 1.5.

Our models show that assuming a detected planet has equal probability of 
orbiting the primary or secondary leads to an overestimate of
binarity's population-level effects.
A planet orbiting the secondary does lead to extreme corrections, but these 
cases are rare outliers, because the searchable volume for secondaries is so 
much smaller than that for primaries.
Phrased in terms of the completeness, in our Model \#3 only $\sim 6\%$ of 
selected secondaries are searchable, compared to $\sim 60\%$ of selected 
primaries.
This means that when high-resolution imaging discovers a binary companion in 
a system that hosts a detected transiting planet, the planet is much
more likely to orbit the primary.
This statement is independent of the fact that planets are often confirmed to 
orbit the primary by inferring the stellar density from the transit duration.


\paragraph{On the utility for future occurrence rate measurements}
{\it TESS}\ is expected to discover over $10^4$ giant 
planets~\citep{sullivan_transiting_2015}.
Though they will be difficult to distinguish from false positives, one 
possible use of this overwhelmingly large sample will to measure an
occurrence rate of short-period giant planets.
Our work indicates that if this measurement is to be more accurate than $\sim 
30\%$, binarity cannot be neglected.


\paragraph{Independent approaches for estimating binarity's effects}
T. Barclay et al.\! (in preparation) have performed the exercise of taking 
stars selected by the {\it Kepler}\ team, pairing them with a population of 
secondaries, injecting a realistic distribution of planet radii, 
and then comparing the inferred occurrence rates with the true ones.
In their model, they find that binarity leads to an inferred rate of 
Earth-sized planets $\approx 10\%$ less than the true rate.
In our Model \#3, if all $Z_i$'s are equal (a plausible assumption in 
the lack of evidence to the contrary), the underestimate is by a comparable 
16\%.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\input{conclusion}

\section{Conclusion}
\label{sec:conclusion}

This study presented three simple models for the effects of binarity on 
occurrence rates measured by transit surveys.
The simplest of these models (Model \#1) provides an order-of-magnitude 
estimate of how much binarity biases occurrence rates.
The most realistic of these models (Model \#3) suggests that binarity does 
lead to underestimates in transit survey occurrence rates, but with less than 
$30\%$ relative error.
The model further suggests that hot Jupiter rates measured by transit surveys 
are biased to infer $\approx 1.3\times$ fewer hot Jupiters per star than 
surveys that only measure occurrence rates about single stars ({\it 
    i.e..,} radial velocity surveys).
It also indicates that binarity's effects on the measured 
rates of Earth-sized planets are far smaller than current 
systematic uncertainties.
Though our models are simplistic, their agreement with T. Barclay's recent 
independent simulations indicate that they capture the essential 
ingredients.


%\acknowledgements
%It was a pleasure discussing this work with F. Dai and T. Barclay.

\newpage
\input{hj_rates.tex}

\newpage
\bibliographystyle{yahapj}                            
\bibliography{bibliography} 

\end{document}
